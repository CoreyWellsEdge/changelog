const fs = require('fs');
const path = require('path');
const moment = require('moment-timezone');

// Load the release notes from the file generated by semantic-release
const releaseNotesPath = path.join(process.cwd(), 'CHANGELOG.md');

// Read the release notes file
fs.readFile(releaseNotesPath, 'utf8', (err, data) => {
  if (err) {
    console.error('Error reading release notes:', err);
    process.exit(1);
  }

  // Regex to find the release date in the format (yyyy-mm-dd)
  const dateRegex = /\(\d{4}-\d{2}-\d{2}\)/g;

  // Adjust date format to "DD-MM-YYYY" for Australia/Brisbane time zone
  const updatedData = data.replace(dateRegex, (match) => {
    const date = match.replace(/[()]/g, ''); // Remove parentheses
    const formattedDate = moment.tz(date, 'YYYY-MM-DD', 'Australia/Brisbane').format('DD-MM-YYYY');
    return `(${formattedDate})`;
  });

  // Write the updated release notes back to the file
  fs.writeFile(releaseNotesPath, updatedData, 'utf8', (err) => {
    if (err) {
      console.error('Error writing updated release notes:', err);
      process.exit(1);
    }
    console.log('Release date updated successfully!');
  });
});
